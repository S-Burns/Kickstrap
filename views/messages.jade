extends layout

block content
	include _header

	.container
		section.row(ng-controller='MessagesCtrl')
			link(
				ng-repeat='contact in contacts'
				rel="prerender", 
				href="http://api.rethumb.com/v1/square/120/http://upload.wikimedia.org/wikipedia/commons/{{contact.img}}"
			)
			div.col.col-sm-12.col-md-3
				h1 Messages
				p.lead
					a(href="#", onclick="$.growl({title: 'Not yet implemented.', delay: 3000})") New
				article.panel.panel-default
					.panel-heading 
						input.form-control(type='text', ng-model='threadInput', placeholder='Search Threads')
					.list-group.ks-beforeload
						p.list-group-item Loading...
					.list-group.ks-afterload
						a.list-group-item(
							ng-repeat='thread in allThreads | filter: threadInput'
							ng-click='setSelectedThread(thread)'
							href="#message"
							ng-class="{'active': selectedThread.threadId == thread.threadId }"
						) 
							.media
								img.media-object.pull-left(src="http://images.weserv.nl/?url=upload.wikimedia.org/wikipedia/commons/{{contactForId(thread.messages[0].contactId).img}}&h=128&w=128&t=square", style="width: 64px;")
								.media-body
									h4.media-heading {{thread.subject}}
									p.text-muted(style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;") {{thread.messages[0].text}}
			div#message(style="padding-top: 50px;")
				nav.navbar.navbar-default.visible-sm.visible-xs
					.container
						ul.nav.navbar-nav	
							li
								a(href="#") 
									span.glyphicon.glyphicon-chevron-left 
									|  Messages
			div.col.col-sm-12.col-md-9.ks-afterload
				h1 {{selectedThread.subject}}
				br
				div(ng-repeat='message in selectedThread.messages')
					.media
						img.media-object.pull-left(src="http://images.weserv.nl/?url=upload.wikimedia.org/wikipedia/commons/{{contactForId(message.contactId).img}}&h=128&w=128&t=square", style="width: 64px;")
						.media-body
							p 
								strong {{contactForId(message.contactId).fName}} {{contactForId(message.contactId).lName}}
							p {{message.text}}
							.clearfix
							p.pull-right
								small
									em.text-muted Sent at {{message.date}}
					hr